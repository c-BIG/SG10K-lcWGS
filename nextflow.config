// global configuration
manifest {
  name = 'SG10K-lcWGS'
  author = 'Justin Jeyakani, Mar Gonzalez-Porta, Maxime HEBRARD, Kevin Nathanael Ramanto, Nicolas Bertin'
  homePage = 'https://github.com/c-BIG/SG10K-lcWGS'
  description = 'Nextflow SG10K-lcWGS reference panel generation.'
  mainScript = 'main.nf'
  nextflowVersion = '!>=23.04.1'
  version = '0.1.0'
}


cleanup = true

params {

    // output
    outdir = "."
    publishdir = "${params.publish_dir}/results"
    info_dir = "${params.publish_dir}/pipeline_info"
    publish_mode = 'copy'

    // help
    params.help = null

}

// launch info

trace {
    enabled = true
    overwrite = true
    file = "${params.info_dir}/trace.txt"
}

// generate timeline

timeline {
    enabled = true
    overwrite = true
    file = "${params.info_dir}/timeline.html"
}

report {
    enabled = true
    overwrite = true
    file = "${params.info_dir}/report.html"
}

dag {
	enabled = true
        overwrite = true
	file = "${params.info_dir}/dag.html"
}


// s3
plugins {
	id "nf-amazon"
}

aws.client.downloadParallel = true
// aws.client.downloadNumWorkers = 20
aws.client.maxConnections = 4
aws.batch.maxParallelTransfers = 8

	
// docker
docker.enabled = true
docker.fixOwnership = true

// launch profiles
profiles {
	local {
		process.executor = "local"
		process.container = "sg10k-lcwgs:latest"
		process.errorStrategy = "finish"
		//process.maxRetries = 1
	}
}

// process resources
process {

    shell = [ '/bin/bash', '-euo', 'pipefail' ]

        errorStrategy = 'retry'
        maxRetries = 2

        withName:refpanel {
                cpus = 8
                memory = "8 GB"
        }
}
